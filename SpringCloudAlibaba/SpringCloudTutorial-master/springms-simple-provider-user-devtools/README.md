# SpringCloud（第 038 篇）idea环境热部署微服务开发
-

## 一、大致介绍

``` 
1、我们在开发过程中，会经常需要启动、停止微服务，而且有时候会比较频繁，需要不停的操作启停动作；
2、而我们本章节主要讲解下如何在开发环境中进行热部署，这样的话可以在一定程度上专心敲代码，两耳不闻窗外事，一心只想敲代码；
```

## 二、实现步骤

### 2.1 添加 maven 引用包
``` 
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

	<artifactId>springms-simple-provider-user-devtools</artifactId>
    <version>1.0-SNAPSHOT</version>
    <packaging>jar</packaging>
	
    <parent>
        <groupId>com.springms.cloud</groupId>
        <artifactId>springms-spring-cloud</artifactId>
        <version>1.0-SNAPSHOT</version>
    </parent>
	
	<dependencies>
        <!-- 访问数据库模块 -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>

        <!-- web模块 -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- h2数据库模块 -->
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <scope>runtime</scope>
        </dependency>

        <!-- 支持Apache Solr搜索平台，包括spring-data-solr -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-solr</artifactId>
		</dependency>

        <!-- 热部署模块 -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
            <optional>true</optional>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <fork>true</fork>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>

```


### 2.2 添加应用配置文件（springms-simple-provider-user-devtools\src\main\resources\application.yml）
``` 
server:
  port: 8305
spring:
  application:
    name: springms-simple-provider-user-devtools  #全部小写
  jpa:
    generate-ddl: false
    show-sql: true
    hibernate:
      ddl-auto: none
  datasource:
    platform: h2
    schema: classpath:schema.sql
    data: classpath:data.sql
  thymeleaf:
    cache: false
logging:
  level:
    root: INFO
    org.hibernate: INFO
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    org.hibernate.type.descriptor.sql.BasicExtractor: TRACE
    com.springms: DEBUG

```


### 2.3 添加 H2 数据库脚本（springms-simple-provider-user-devtools\src\main\resources\schema.sql）
``` 
drop table user if exists;

CREATE TABLE USER(
	id BIGINT GENERATED by default as identity,
	username VARCHAR(40),
	name VARCHAR(20),
	age int(3),
	balance DECIMAL(10, 2),
	PRIMARY KEY(id)
);

```


### 2.4 插入 H2 数据库一些初始化数据（springms-simple-provider-user-devtools\src\main\resources\data.sql）
``` 
INSERT into user (id, username, name, age, balance) values (1, 'user1', '张三', 20, 100.00);
INSERT into user (id, username, name, age, balance) values (2, 'user2', '李四', 22, 100.00);
INSERT into user (id, username, name, age, balance) values (3, 'user3', '王五', 24, 100.00);
INSERT into user (id, username, name, age, balance) values (4, 'user4', '赵六', 26, 100.00);
INSERT into user (id, username, name, age, balance) values (5, 'user5', '李逵', 27, 100.00);
INSERT into user (id, username, name, age, balance) values (6, 'user6', '张远', 10, 100.00);
INSERT into user (id, username, name, age, balance) values (7, 'user7', '迪拜', 60, 100.00);
INSERT into user (id, username, name, age, balance) values (8, 'user8', '哈士奇', 40, 100.00);
INSERT into user (id, username, name, age, balance) values (9, 'user9', '关羽', 30, 100.00);

```

### 2.5 添加访问底层数据模型的DAO接口（springms-simple-provider-user-devtools\src\main\java\com\springms\cloud\repository\UserRepository.java）
``` 
package com.springms.cloud.repository;

import com.springms.cloud.entity.User;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository
public interface UserRepository extends JpaRepository<User, Long> {

}

```

### 2.6 添加实体用户类User（springms-simple-provider-user-devtools\src\main\java\com\springms\cloud\entity\User.java）
``` 
package com.springms.cloud.entity;

import java.math.BigDecimal;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class User {
  @Id
  @GeneratedValue(strategy = GenerationType.AUTO)
  private Long id;

  @Column
  private String username;

  @Column
  private String name;

  @Column
  private Short age;

  @Column
  private BigDecimal balance;

  public Long getId() {
    return this.id;
  }

  public void setId(Long id) {
    this.id = id;
  }

  public String getUsername() {
    return this.username;
  }

  public void setUsername(String username) {
    this.username = username;
  }

  public String getName() {
    return this.name;
  }

  public void setName(String name) {
    this.name = name;
  }

  public Short getAge() {
    return this.age;
  }

  public void setAge(Short age) {
    this.age = age;
  }

  public BigDecimal getBalance() {
    return this.balance;
  }

  public void setBalance(BigDecimal balance) {
    this.balance = balance;
  }
}

```

### 2.7 添加用户Web访问层Controller（springms-simple-provider-user-devtools/src/main/java/com/springms/cloud/controller/SimpleProviderUserDevtoolsController.java）
``` 
package com.springms.cloud.controller;

import com.springms.cloud.entity.User;
import com.springms.cloud.repository.UserRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;

/**
 * 用户微服务Controller（支持 idea 热部署）。
 *
 * @author hmilyylimh
 *
 * @version 0.0.1
 *
 * @date 17/10/18
 *
 */
@RestController
public class SimpleProviderUserDevtoolsController {

    @Autowired
    private UserRepository userRepository;

    @GetMapping("/simple/{id}")
    public User findById(@PathVariable Long id) {
        return this.userRepository.findOne(id);
    }

    @GetMapping("simple")
    public String simple() {
        return "simple-2017-09";
    }

    @GetMapping("simple2")
    public String simple2() {
        return "simple2-2017";
    }
}


```


### 2.8 添加简单用户微服务启动类（springms-simple-provider-user-devtools\src\main\java\com\springms\cloud\MsSimpleProviderUserApplication.java）
``` 
package com.springms.cloud;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * 简单用户微服务类（支持 idea 热部署）。
 *
 * @author hmilyylimh
 *
 * @version 0.0.1
 *
 * @date 17/10/18
 *
 */
@SpringBootApplication
public class MsSimpleProviderUserDevtoolsApplication {

	public static void main(String[] args) {
		SpringApplication.run(MsSimpleProviderUserDevtoolsApplication.class, args);
		System.out.println("【【【【【【 简单用户微服务（热部署） 】】】】】】已启动.");
	}
}
```



## 三、测试

``` 
/****************************************************************************************
 一、简单用户微服务接口测试：

 1、添加 spring-boot-devtools 热部署依赖；
 2、pom.xml 添加 <fork>true</fork> 属性；
 3、设置 idea 属性：“File” -> “Settings” -> “Build,Execution,Deplyment” -> “Compiler”，选中打勾 “Build project automatically” ；
 4、设置 idea 属性：组合键：“Shift+Ctrl+Alt+/” ，选择 “Registry” ，选中打勾 “compiler.automake.allow.when.app.running” ；
 5、设置缓存配置 spring.thymeleaf.cache=false；
 6、设置 chrome 属性：F12或者“Ctrl+Shift+I”，打开开发者工具，“Network” 选项卡下 选中打勾 “Disable Cache(while DevTools is open)” ；

 7、启动 springms-simple-provider-user-devtools 模块服务，启动1个端口；
 8、在浏览器输入地址 http://localhost:8305/simple 可以看到信息成功的被打印出来；

 9、改动 Controller 某个方法的返回值，或者新增方法，然后会看到控制台自动重启该应用，进行热部署；
 10、再在浏览器请求刚刚改动的链接，发现链接返回的内容确实动态改变过来了，这就是热部署；
 ****************************************************************************************/
```




## 四、下载地址

[https://gitee.com/ylimhhmily/SpringCloudTutorial.git](https://gitee.com/ylimhhmily/SpringCloudTutorial.git)

SpringCloudTutorial交流QQ群: 235322432

SpringCloudTutorial交流微信群: [微信沟通群二维码图片链接](https://gitee.com/ylimhhmily/SpringCloudTutorial/blob/master/doc/qrcode/SpringCloudWeixinQrcode.png)

欢迎关注，您的肯定是对我最大的支持!!!

































